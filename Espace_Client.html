<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NatureEmoi - Espace Client</title>
    <link rel="icon" href="Home/icone2.ico">
    <link href="Espace_Client.css" rel="stylesheet">
</head>
<body>
    <h1>Espace Client NatureEmoi</h1>
    
    <!-- Container principal avec votre style exact -->
    <div class="form-container">
        <!-- ONGLETS -->
        <div class="tabs-header">
            <button class="tab-btn active" onclick="switchTab('register')" id="registerTabBtn">
                Inscription
            </button>
            <button class="tab-btn" onclick="switchTab('login')" id="loginTabBtn">
                Connexion
            </button>
        </div>

        <!-- FORMULAIRE D'INSCRIPTION -->
        <div id="registerSection" class="tab-content active">
            <form id="registerForm">
                <label for="regNom">Nom d'utilisateur :</label>
                <input type="text" id="regNom" name="nom" required>
                
                <label for="regEmail">Email :</label>
                <input type="email" id="regEmail" name="email" required>
                
                <label for="regPassword">Mot de passe :</label>
                <div class="password-field">
                    <input type="password" id="regPassword" name="password" required>
                    <span class="password-toggle" onclick="togglePassword('regPassword')">üëÅÔ∏è</span>
                </div>
                <div id="passwordStrength" class="password-strength"></div>
                
                <label for="regAdresse">Adresse :</label>
                <input type="text" id="regAdresse" name="adresse" required>
                
                <label for="regTelephone">Num√©ro de t√©l√©phone :</label>
                <input type="tel" id="regTelephone" name="telephone" required>
                
                <button type="submit" id="registerBtn">S'inscrire</button>
            </form>
        </div>

        <!-- FORMULAIRE DE CONNEXION -->
        <div id="loginSection" class="tab-content">
            <form id="loginForm">
                <label for="loginEmail">Email :</label>
                <input type="email" id="loginEmail" name="email" required>
                
                <label for="loginPassword">Mot de passe :</label>
                <div class="password-field">
                    <input type="password" id="loginPassword" name="password" required>
                    <span class="password-toggle" onclick="togglePassword('loginPassword')">üëÅÔ∏è</span>
                </div>
                
                <button type="submit" id="loginBtn">Se connecter</button>
                
                <div class="forgot-link">
                    <a href="#" onclick="showForgotPassword()">Mot de passe oubli√© ?</a>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        console.log('üå± Page charg√©e - JavaScript activ√©');
        
        // Variables globales
        let currentTab = 'register';
        
        // Fonction pour changer d'onglet
        function switchTab(tabName) {
            // Retirer la classe active de tous les onglets et contenus
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Activer l'onglet et le contenu s√©lectionn√©s
            document.getElementById(tabName + 'TabBtn').classList.add('active');
            document.getElementById(tabName + 'Section').classList.add('active');
            
            currentTab = tabName;
            console.log('Onglet actif:', tabName);
        }
        
        // Fonction pour basculer la visibilit√© du mot de passe
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggle = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                toggle.textContent = 'üôà';
            } else {
                input.type = 'password';
                toggle.textContent = 'üëÅÔ∏è';
            }
        }
        
        // Fonction pour v√©rifier la force du mot de passe
        function checkPasswordStrength(password) {
            const strengthDiv = document.getElementById('passwordStrength');
            let strength = 0;
            let message = '';
            
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            switch (strength) {
                case 0:
                case 1:
                    strengthDiv.className = 'password-strength strength-weak';
                    message = 'Mot de passe faible';
                    break;
                case 2:
                case 3:
                    strengthDiv.className = 'password-strength strength-medium';
                    message = 'Mot de passe moyen';
                    break;
                case 4:
                case 5:
                    strengthDiv.className = 'password-strength strength-strong';
                    message = 'Mot de passe fort';
                    break;
            }
            
            strengthDiv.textContent = message;
        }
        
        // Fonction pour afficher des messages
        function showMessage(message, type = 'success') {
            console.log(`üì¢ Message: ${message} (${type})`);
            
            // Supprimer ancien message
            const existing = document.querySelector('.message-popup');
            if (existing) existing.remove();
            
            // Cr√©er nouveau message
            const div = document.createElement('div');
            div.className = `message-popup ${type}`;
            div.innerHTML = `
                <span class="message-icon">${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                <span class="message-text">${message}</span>
            `;
            
            document.body.appendChild(div);
            
            // Supprimer apr√®s 5 secondes
            setTimeout(() => {
                if (div.parentNode) div.remove();
            }, 5000);
            
            // Supprimer en cliquant
            div.onclick = () => {
                if (div.parentNode) div.remove();
            };
        }
        
        // Fonction pour g√©rer l'√©tat du bouton
        function setButtonLoading(buttonId, loading) {
            const btn = document.getElementById(buttonId);
            if (loading) {
                btn.disabled = true;
                btn.textContent = buttonId === 'registerBtn' ? 'Inscription...' : 'Connexion...';
            } else {
                btn.disabled = false;
                btn.textContent = buttonId === 'registerBtn' ? 'S\'inscrire' : 'Se connecter';
            }
        }
        
        // Gestion de l'inscription
        function handleRegister(event) {
            event.preventDefault();
            console.log('üöÄ === INSCRIPTION ===');
            
            setButtonLoading('registerBtn', true);
            
            const formData = {
                nom: document.getElementById('regNom').value.trim(),
                email: document.getElementById('regEmail').value.trim(),
                password: document.getElementById('regPassword').value,
                adresse: document.getElementById('regAdresse').value.trim(),
                telephone: document.getElementById('regTelephone').value.trim()
            };
            
            console.log('üì¶ Donn√©es d\'inscription:', { ...formData, password: '[MASQU√â]' });
            
            // Validation
            if (!formData.nom || !formData.email || !formData.password || !formData.adresse || !formData.telephone) {
                setButtonLoading('registerBtn', false);
                showMessage('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            if (formData.password.length < 6) {
                setButtonLoading('registerBtn', false);
                showMessage('Le mot de passe doit contenir au moins 6 caract√®res', 'error');
                return;
            }
            
            // Envoyer la requ√™te d'inscription
            fetch('/api/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(result => {
                setButtonLoading('registerBtn', false);
                
                if (result.success) {
                    showMessage('Inscription r√©ussie ! Vous pouvez maintenant vous connecter.', 'success');
                    document.getElementById('registerForm').reset();
                    document.getElementById('passwordStrength').textContent = '';
                    
                    // Basculer vers l'onglet connexion
                    setTimeout(() => {
                        switchTab('login');
                        document.getElementById('loginEmail').value = formData.email;
                    }, 2000);
                } else {
                    showMessage(result.message || 'Erreur lors de l\'inscription', 'error');
                }
            })
            .catch(error => {
                console.error('‚ùå Erreur inscription:', error);
                setButtonLoading('registerBtn', false);
                showMessage('Erreur de connexion. Veuillez r√©essayer.', 'error');
            });
        }
        
        // Gestion de la connexion
        function handleLogin(event) {
            event.preventDefault();
            console.log('üîê === CONNEXION ===');
            
            setButtonLoading('loginBtn', true);
            
            const formData = {
                email: document.getElementById('loginEmail').value.trim(),
                password: document.getElementById('loginPassword').value
            };
            
            console.log('üì¶ Donn√©es de connexion:', { ...formData, password: '[MASQU√â]' });
            
            // Validation
            if (!formData.email || !formData.password) {
                setButtonLoading('loginBtn', false);
                showMessage('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            // Envoyer la requ√™te de connexion
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(result => {
                setButtonLoading('loginBtn', false);
                
                if (result.success) {
                    // Stocker les donn√©es utilisateur
                    localStorage.setItem('naturemoi_user', JSON.stringify(result.user));
                    
                    showMessage(`Connexion r√©ussie ! Bienvenue ${result.user.nom}.`, 'success');
                    
                    // Rediriger vers l'accueil
                    setTimeout(() => {
                        window.location.href = '/Home/home.html';
                    }, 2000);
                } else {
                    showMessage(result.message || 'Erreur de connexion', 'error');
                }
            })
            .catch(error => {
                console.error('‚ùå Erreur connexion:', error);
                setButtonLoading('loginBtn', false);
                showMessage('Erreur de connexion. Veuillez r√©essayer.', 'error');
            });
        }
        
        // Fonction pour mot de passe oubli√©
        function showForgotPassword() {
            showMessage('Fonction "Mot de passe oubli√©" en cours de d√©veloppement', 'error');
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìù DOM charg√© - Initialisation');
            
            // Event listeners pour les formulaires
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Event listener pour la v√©rification du mot de passe
            document.getElementById('regPassword').addEventListener('input', function() {
                checkPasswordStrength(this.value);
            });
            
            console.log('‚úÖ Event listeners ajout√©s');
        });
    </script>
</body>
</html>